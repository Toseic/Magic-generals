# Generals 将军棋

## 游戏介绍



[generals](https://link.zhihu.com/?target=http%3A//generals.io)游戏，又名将军棋，此游戏以调兵遣将作为主要玩点，可以体验多方对抗中的心理博弈以及战术思想。

游戏规则，在x*y(16<=x,y<=23)个方格构成的的地图上，每个地图上面可以是山地，王城，古城，空白的土地。

山地是不可占领或者路过的土地，王城即为玩家的大本营，游戏初始时玩家从大本营出发，初始时大本营里面有1个士兵。

时间单位：1`turn`即为现实生活中的1s, 已经被攻占的城市（王城或者古城）每一turn会增加一个士兵，在有士兵的土地上（包括城市），每25turn增加一个士兵。

古城即上图深灰色标有数字的格子，古城上的数字代表城内守卫的兵力。你可以花费 数量的士兵占领古城，占领后古城将变为你的城池。你的城池与你的王城古城守卫兵力+1一样，每 1 turn 会为你生产 1 个兵，所以拥有自己的城池至关重要。

迷雾

<img src="https://dev.generals.io/replay.gif" style="zoom:50%;" />

## AI部分

### 数据集

#### 获取

此网站提供了通过api接口接入玩家的程序bot的服务，

图片，

另外还提供了收集的对局数据供训练bot使用

图片

但是，当我们试着下载对局时:

图片（链接是坏的）

但是网站的管理员认为这个链接不需要修复（坏了就坏了吧...）：

图片

但是好在这个网站另外还提供了下载单次对局回放的功能：

图片

于是写了一个网络爬虫，爬取了排行榜上前三十的玩家，大约八万局数据：[link](https://github.com/Toseic/Generals.io_crawl)

图片



### 数据结构

显而易见：直接拿一个二维的向量储存就行了

问题：数据集里面的地图的尺寸是不确定的，那怎么办呢？

图片（尺寸统计信息）

将地图放大到25*25，相较于原地图多出来的部分放置山峰，也就是士兵不能到达的地方，原地图嵌在新地图的左上方，。

图片

#### 输入：

包含十个通道，内容均为没被迷雾遮挡的部分

| 内容                                            | 通道数 |
| ----------------------------------------------- | ------ |
| 自己以及敌人的土地                              | 2      |
| 自己以及敌人的城市                              | 2      |
| 自己以及敌人的大本营                            | 2      |
| 尚未被人攻占的城市                              | 1      |
| 山峰                                            | 1      |
| 自己距离下一个城市增加士兵（per 1 turn）的时间  | 1      |
| 自己距离下一个土地增加士兵（per 25 turn）的时间 | 11     |



思考：由于地图的右方和下方固定会有大量的一片山峰，这会不会对AI的学习产生影响呢？ -> 数据增强

### 数据增强

由于这个游戏的结构就是一张地图，数据增强的方式也显而易见，将地图以按一定概率旋转，翻转之后，生成新的数据。

原因：

### 模型结构：

图片，图片

使用了二维卷积，12层resblock,

## UI部分

众所周知，UI对于一个游戏至关重要。

### 简约线条：

这个版本的UI仅仅只是用于调试，可以拿来复现已有的对局，赛博朋克风格（X

不支持人类输入
![img1](https://user-images.githubusercontent.com/97432569/171473506-ad83a3e1-8dab-4e61-add6-134b78cc78ce.gif)


### 极致色彩：

使用pygame框架，可以实现基本与网站上类似的体验，包括鼠标点击事件，键盘输入事件等等，支持人机对局，AI对局，暂时不支持双人对局

缺点：画质较低（屏幕兼容问题）

图片



## future:

1.  让我们的AI加入到网站里面进行对战
2. 设计本地对战平台，可以短时间进行大量对局，以用于比较AI的水平
3. 写搜索算法，跟AI对战，查看效果
4. 开发双人对局功能（网络双端连接？）
